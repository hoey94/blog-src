<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-96af1f0b-3784-4c58-a812-4926d57ac624"></attachment><p>---</p><p>title: AVL Tree</p><p>date: 2020-12-19 19:33:25</p><p>categories: JVM</p><p>---</p><p><br></p><h3>JVM 运行时数据区</h3><h4><br></h4><h4>1. Program Counter Register</h4><p><br></p><p>程序计数器PC 是用来记录指令运行的位置，属于线程私有。</p><p><br></p><h4>2.JVM Stack</h4><p><br></p><p>方法栈,  本身属于栈类型的数据结构，其中以Stack Frame为基本单元作存储，数据线程私有。每次方法的调用，对应栈针在虚拟机栈中入栈和出栈的过程。</p><p><br></p><p>每个Stack Frame包含一下内容，局部变量表、操作数栈、动态链接、方法出口等信息。</p><p><br></p><p>局部变量表类似于微程序处理器中的寄存器IR，主要存放各种逻辑运算的变量，操作数栈用于对操作数进行逻辑运算，动态链接用于链接常量池的引用，方法出口代表的是每次函数调用完成以后，下一个Stack Frame的内存地址。</p><p><br></p><h4>3.Native Method Stack</h4><p><br></p><p>其余JVM Stack 都有一个Stack ，它们的区别在于 JVM Stack 是用于普通方法，而Native Method Stack是用于本地方法，本地方法就是Java 调用 C/C++的程序接口</p><p><br></p><h4>4.Heap</h4><p><br></p><p>堆是JVM运行时数据区内的一个核心区域，是大量对象实例化后存放的区域。在分代垃圾收集器时代，Heap在物理上被划分为 Young Space, Old Space，利用分代和不同的GC回收算法，完成C/C++语言必须用手动完成的工作-垃圾回收。</p><p><br></p><p>Heap上是对象存放的区域，常常是牵扯JVM调优，它对于程序优化都至关重要。</p><p><br></p><h4>5.Direct Memory</h4><p><br></p><p>问：是否存在接近内存写的持久化操作？答案就是它，Dierect Memory，直接内存。利用DMA和PageCache页缓存等现代操作系统特点，完成异步写数据，主要是实现ZeroCopy，在Java有对应的API 为：Channel.TransferTo / Channel.TransferFrom</p><p><br></p><h4>6.Method Area</h4><p><br></p><p>方法区被线程共享，主要存放类信息、常量、静态变量、即时编译后的代码等数据。</p><p><br></p><h3>OOM</h3><p><br></p><p>对于OOM，我们不难发现，除了PC不用存储对象以外，其他所有区域都是需要。所以OOM类型有以下几种：</p><p><br></p><h4>1.Heap</h4><p><br></p><p>Heap  内存移除会抛出下面异常java.lang.OutofMemoryError ，这个时候我们需要检查Heap内存情况，常用的优化参数有:</p><p><br></p><p>-Xms: 调整Heap 初始化内存大小</p><p>-Xmx: 调整Heap 最大内存</p><p>-Xmn: 调整Young Space 内存大小</p><p><br></p><p>觉得记不住，JVM给我们提供了参数手册: -XX:+PrintFlagsFinal -version</p><p><br></p><h4>2.Method Area</h4><p><br></p><p>JDK1.8以前，方法区又被叫做PermGen Space。在1.8的HotSpot被叫做MetaSpace，method area中存放，常量、静态变量等信息，如果内存不足会抛OutOfMemoryError</p><p><br></p><h4>3.Stack</h4><p><br></p><p>栈上空间不足往往不会抛OOM，对应的是StackOverflowError</p><h3><br></h3><h4>4.小结</h4><p><br></p><p>对应内存问题，我们应该优先考虑将日志Dump下来，所谓无监控不调优。可以在启动JVM时，使用参数-XX:+HeapDumpOnOutOfMemory参数，在发生OOM时自动dump信息到磁盘，除此之外还可以使用Jmap、JHat进行内存方面异常排查， 但是jmap最好在服务器闲置是使用，对于生产来说dump线程信息是十分危险的操作。</p><p><br></p><p><br></p>